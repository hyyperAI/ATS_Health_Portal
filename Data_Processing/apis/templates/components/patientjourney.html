<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <link rel="icon" href="../static/assets/img/avatar/logo.png" type="image/gif" sizes="16x16">
      <title>Patient Journey</title>
      <meta name="og:description" content="unveiling the dataments free bootstrap admin dashboard template, your ultimate solution to a seamless web management experience! this is more than just a template; it's your partner in crafting a digital masterpiece.">
      <meta name="robots" content="index, follow">
      <meta name="og:title" property="og:title" content="dataments - free bootstrap admin dashboard template">
      <meta property="og:image" content="#">
      <!-- bootstrap css link -->
      <link rel="stylesheet" href="../static/lib/bootstrap_5/bootstrap.min.css">
      <!-- Font Awesome CDN -->
      <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css'>
      <!-- main css -->
      <link rel="stylesheet" href="../static/assets/css/global.css" >
      <link rel="stylesheet" href="../static/assets/css/style.css">
      <!-- responsive css -->
      <link rel="stylesheet" href="../static/assets/css/responsive.css">
      <!-- Timeline -->
      <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
      <!-- custom js -->
      <script src="../static/assets/js/main.js"></script>
      
      
      <script src="../static/lib/bootstrap_5/bootstrap.bundle.min.js"></script>
      <!-- <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/css/materialize.min.css" rel="stylesheet" type="text/css" />  -->
      <script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha384-nvAa0+6Qg9clwYCGGPpDQLVpLNn0fRaROjHqs13t4Ggj3Ez50XnGQqc/r8MhnRDZ" crossorigin="anonymous"></script>
      <script src="../static/lib/jQuery/jquery.roadmap.js" type="text/javascript"></script>
      <link href="../static/lib/jQuery/jquery.roadmap.min.css" rel="stylesheet" type="text/css" />
   </head>
   <body >
      <div class="d2c_wrapper" >
         <!-- sidebar -->
         <div class="d2c_sidebar rounded-4 px-4 py-4 py-md-4 m-4 me-0" id="sidebar">
            <div class="d-flex flex-column h-100">
               <a href="../index.html" class="mb-0 brand-icon">
               <img class="navbar-brand w-100" src="../static/assets/img/avatar/logo.png" alt="logo">
               </a>
               <hr class="divider">
               <ul class="navbar-nav flex-grow-1" id="d2c_Sidebar">
                  <!-- Menu Item -->
                  <li class="nav-item">
                     <a class="nav-link" href="../index.html">
                     <i class="fas fa-home me-2"></i>
                     <span>Home</span>
                     </a>
                  </li>
                  <!-- Menu Item -->
                  
                 <li class="nav-item">
                  <a class="nav-link" href="dashboard_icu.html">
                     <i class="fas fa-layer-group me-2"></i>
                  <span>ICU</span>
                  </a>
               </li>
                  <!-- Menu Item -->
                  <li class="nav-item">
                     <a class="nav-link" href="patientjourney.html">
                     <i class="fas fa-list me-2"></i>
                     <span>Patient Journey</span>
                     </a>
                  </li>
                  <!-- Menu Item -->
                  <!-- Dropdown: Menu Item -->
                   
                  <li class="nav-item" style=" margin-top:100%">
                     <a class="nav-link " href="email.html">
                     <i class="fas fa-home me-2"></i>
                     <span>Message</span>
                     </a>
                  </li>
                  <li class="nav-item">
                     <a class="nav-link " href="../pages/notifications.html">
                     <i class="fas fa-home me-2"></i>
                     <span>Notifications</span>
                     </a>
                  </li>
                  
                  <!-- Menu Item -->
                  <li class="nav-item">
                     <a class="nav-link" href="../pages/profile.html">
                     <i class="fas fa-book-open me-2"></i>
                     <span>Settings </span>
                     </a>
                  </li>
                  <!-- Menu Item -->
               </ul>
               <hr class="divider">
               <!-- Sidebar: Profile -->
               <div class="sidebar-mini-btn text-light">
                  <div class="dropdown">
                     <a class="dropdown-closer" href="#" role="button" data-bs-toggle="dropdown"
                        aria-expanded="false">
                     <img class="img-profile rounded-circle object-fit-cover border border-2 border-white me-2"
                        src="../static/assets/img/avatar/man-4.png" alt="avatar" width="30" height="30">
                     <span>Abdur Rehman</span>
                     </a>
                     <!-- Dropdown -->
                     <div class="dropdown-menu shadow border-0 end-0 start rounded-3">
                        <a class="dropdown-item" href="../pages/profile.html">
                        <i class="fas fa-user fa-fw me-2 text-gray-400"></i>
                        Profile
                        </a>
                        <a class="dropdown-item" href="#">
                        <i class="fas fa-comment-alt fa-fw me-2 text-gray-400"></i>
                        Message
                        </a>
                        <a class="dropdown-item" href="#">
                        <i class="fas fa-cog fa-fw me-2 text-gray-400"></i>
                        Profile Setting
                        </a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#" data-toggle="modal" data-target="#logoutModal">
                        <i class="fas fa-sign-out-alt fa-fw me-2 text-gray-400"></i>
                        Logout
                        </a>
                        <div class="dropdown-arrow bg-info"></div>
                     </div>
                  </div>
               </div>
               <!-- Sidebar: Profile -->
            </div>
         </div>
         <!-- Page Content  -->
         <div class="d2c_main px-lg-4 px-md-4 px-3">
            <!-- Top Nav -->
            <nav
               class="navbar navbar-expand navbar-light sticky-top bg-white shadow py-2 px-3 rounded-4 d2c_top_navbar my-4">
               <!-- Sidebar toggler -->
               <button type="button" id="sidebarCollapse"
                  class="btn btn-transparent text-info d2c_sidebar_collapse me-1">
               <i class="fas fa-bars"></i>
               </button>
               <!-- Sidebar toggler -->
               <div>
                  <!--  Form -->
                  <form class="form d2c_nav_form me-3 d-none d-md-flex" role="">
                     <div class="input-group">
                        <button class="btn btn-outline-info rounded-end rounded-pill border-end-0" type="submit">
                        <i class="fas fa- fa-sm"></i>
                        </button>
                        <input class="form-control border-start-0 rounded-start rounded-pill" type=""
                           placeholder="..." aria-label="" required>
                     </div>
                  </form>
                  <!--  Form: Nav Item -->
                  <div class="d-flex d-md-none">
                     <!--  Box: Nav Item -->
                     <a class="nav-link text-info" href="#" role="button" data-bs-toggle="dropdown"
                        aria-expanded="false">
                     <i class="fas fa- fa-sm"></i>
                     </a>
                     <ul class="dropdown-menu p-0 mt-0 border-0 rounded-pill">
                        <li>
                           <form class="form d2c_nav_form" role="">
                              <div class="input-group">
                                 <button class="btn btn-outline-info rounded-end rounded-pill border-end-0"
                                    type="submit">
                                 <i class="fas fa- fa-sm"></i>
                                 </button>
                                 <input class="form-control border-start-0 rounded-start rounded-pill"
                                    type="" placeholder="..." aria-label="" required>
                              </div>
                           </form>
                        </li>
                     </ul>
                  </div>
               </div>
               <!--  Form: Nav Item -->
               <ul class="navbar-nav align-items-center mb-lg-0 ms-auto">
                  <!-- Notification: Nav Item -->
                  <li class="nav-item d2c_dropdown_right dropdown me-3">
                     <a class="nav-link text-info p-0" href="#" role="button" data-bs-toggle="dropdown"
                        aria-expanded="false">
                     <i class="fas fa-bell fa-fw"></i>
                     <span
                        class="position-absolute top-0 start-100 translate-middle p-1 bg-secondary border rounded-circle"></span>
                     </a>
                     <div class="dropdown-list dropdown-menu dropdown-menu-right shadow border-0 py-0 mt-3">
                        <h6 class="dropdown-header text-white bg-info rounded-top py-3">Notifications</h6>
                        <a class="dropdown-item d-flex align-items-center" href="../pages/notifications.html">
                           <div class="text-truncate d-block">
                              <p class="mb-0"><small>19 sec ago</small></p>
                              <h6 class="mb-0">Hi there! I am wondering if you can help me with a problem I've been having.</h6>
                           </div>
                        </a>
                        <a class="dropdown-item d-flex align-items-center" href="../pages/notifications.html">
                           <div class="text-truncate d-block">
                              <p class="mb-0"><small>2 min ago</small></p>
                              <h6 class="mb-0">
                                 I have the photos that you ordered last month, how would
                                 you like them sent to you?
                              </h6>
                           </div>
                        </a>
                        <a class="dropdown-item d-flex align-items-center" href="../pages/notifications.html">
                           <div class="text-truncate d-block">
                              <p class="mb-0"><small>3 min ago</small></p>
                              <h6 class="mb-0">Last month's report looks great, I am very happy with
                                 the progress so far, keep up the good work!
                              </h6>
                           </div>
                        </a>
                        <a class="dropdown-item d-flex align-items-center" href="../pages/notifications.html">
                           <div class="text-truncate d-block">
                              <p class="mb-0"><small>4 min ago</small></p>
                              <h6 class="mb-0">Am I a good boy? The reason I ask is because someone
                                 told me that people say this to all dogs, even if they
                                 aren't good...
                              </h6>
                           </div>
                        </a>
                        <a class="dropdown-item text-center small text-gray-500 py-2"
                           href="../pages/notifications.html">See All
                        Notifications</a>
                        <div class="dropdown-arrow bg-info"></div>
                     </div>
                  </li>
                  <!-- Notification: Nav Item -->
                  <!-- MailBox: Nav Item -->
                  <li class="nav-item d2c_dropdown_right dropdown me-3">
                     <a class="nav-link position-relative text-info p-0" href="#" role="button"
                        data-bs-toggle="dropdown" aria-expanded="false">
                     <i class="fas fa-envelope-open-text"></i>
                     <span
                        class="position-absolute top-0 start-100 translate-middle p-1 bg-danger border border-light rounded-circle"></span>
                     </a>
                     <div class="dropdown-list dropdown-menu shadow border-0 end-0 py-0 mt-3">
                        <h6 class="dropdown-header text-white bg-info rounded-top py-3">Mail</h6>
                        <a class="dropdown-item d-flex align-items-center" href="../components/open_mail.html">
                           <div class="text-truncate">
                              <div>
                                 <img src="../static/assets/img/avatar/man-1.png" class="d2c_mail_avatar" alt="profile avatar">
                              </div>
                              <div>
                                 <p class="mb-0"><small>3 min ago</small></p>
                                 Hi there! I am wondering if you can help me with a
                                 problem I've been having.
                              </div>
                           </div>
                        </a>
                        <a class="dropdown-item d-flex align-items-center" href="../components/open_mail.html">
                           <div class="text-truncate">
                              <div>
                                 <img src="../static/assets/img/avatar/man-2.png" class="d2c_mail_avatar" alt="profile avatar">
                              </div>
                              <div>
                                 <p class="mb-0"><small>4 min ago</small></p>
                                 I have the photos that you ordered last month, how would you like them sent to you?
                              </div>
                           </div>
                        </a>
                        <a class="dropdown-item d-flex align-items-center" href="../components/open_mail.html">
                           <div class="text-truncate">
                              <div>
                                 <img src="../static/assets/img/avatar/man-3.png" class="d2c_mail_avatar" alt="profile avatar">
                              </div>
                              <div>
                                 <p class="mb-0"><small>6 min ago</small></p>
                                 Last month's report looks great, I am very happy with
                                 the progress so far, keep up the good work!
                              </div>
                           </div>
                        </a>
                        <a class="dropdown-item d-flex align-items-center" href="../components/open_mail.html">
                           <div class="text-truncate">
                              <div>
                                 <img src="../static/assets/img/avatar/man-4.png" class="d2c_mail_avatar" alt="profile avatar">
                              </div>
                              <div>
                                 <p class="mb-0"><small>10 min ago</small></p>
                                 Am I a good boy? The reason I ask is because someone
                                 told me that people say this to all dogs, even if they
                                 aren't good...
                              </div>
                           </div>
                        </a>
                        <a class="dropdown-item text-center small text-gray-500 py-2"
                           href="../components/email.html">See All Mail</a>
                        <div class="dropdown-arrow bg-info"></div>
                     </div>
                  </li>
                  <!-- MailBox: Nav Item -->
               </ul>
            </nav>
            <!-- Top Nav -->
            <!-- Main Content -->
            <div class="body">
               
               </nav>
               <div class="card d2c_faq_main">
                  <div class="row">
                     <div class="col-md-10 offset-md-1 col-xl-6 offset-xl-3 text-center">
                        <div class="pb-5">
                           <h2>Patient Journey</h2>
                           <div class="input-group" style="margin-top: 10%;">
                              <input type="text" class="form-control rounded"
                                 placeholder=" patient by subject id" id="patient-id" required>
                              <button class="btn rounded btn-primary text-white mt-3"
                                 id="-button" onclick=" copyid();">Search</button>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="row">
                  <div class="col-12">
                     <div class="card">
                        <div class="card-header">
                           <h5 class="mb-0 text-capitalize"> Patient Details</h5>
                        </div>
                        <div class="d2c_dataTable table-responsive">
                           <table id="table_id_3" class="table table-striped w-100">
                              <thead>
                                 <tr>
                                    <th>Patient_id</th>
                                    <th>Age</th>
                                    <th>Gender</th>
                                    <th>DOD</th>
                                 </tr>
                              <tbody>
                                 <tr>
                                    <td>John Doe</td>
                                    <td>30</td>
                                    <td>New York</td>
                                    <td>2050-01-01</td>
                                 </tr>
                                 <!-- Add more rows as needed -->
                              </tbody>
                              </thead>
                           </table>
                        </div>
                     </div>
                  </div>
               </div>
               <!-- basic timeline -->
               <div style="padding-top: 100px;">

               </div>
               <div id="card">
                  <div id="my-roadmap" style="position:relative;  padding-bottom:10%;">
                     <script src="../static/assets/js/data.js"></script>
                     <script>
                        let patientId123

                         function deleteDiv() {
                        const roadmapDiv = document.getElementById('my-roadmap');
                        if (roadmapDiv) {
                           
                           roadmapDiv.innerHTML = ''; 
                        }
                        }
                        

                        function copyid() {
                        patientId123 = document.getElementById('patient-id').value;
                        console.log(patientId123)
                        deleteDiv();
                        const Button = document.getElementById('-button');
                    
                        fetchDataAndUpdateRoadmap();
                        }
                       
                        
                        async function fetchDataAndUpdateRoadmap() {
                        var events = [];
                        var per_sequence = []
                        try {
                           alert
                        const response = await fetch(`http://127.0.0.1:8000/pat_journey/?sub_id=${patientId123}`);
                        if (!response.ok) {
                           
                        throw new Error(`HTTP error! Status: ${response.status}`);
                        }
                        const data = await response.json();
                        console.log("API response data for patient journey is:", data);
                        var sequence=1;
                        if (data.length < 1){
                           $('#my-roadmap').append('<h3>No data found for this patient.</h3>');
                        }
                        // Merge API response and create dictionary object for each loop iteration
                        for (let i = 0; i < data.length; i++) {
                        const item = data[i];
                      
                        if (i===0){
                           sequence=1;
                        }
                        
                        
                        events.push({

                           date:  ' <br> Visit : ' + sequence ,
                           content:  '<br>Date : '+item.updated_intime.slice(0, 10) +  '<br>Time: ' + item.time + '<br>Location: ' + item.careunit + '<br>Event Type: ' + item.eventtype });
                     
                        // Update events array
                        
                        if (item.eventtype === "discharge") {
                          
                           sequence = sequence+1;
                           per_sequence.push(events)

                           events=[]
                           
                       }
                       else if(i+1===data.length){
                     
                        per_sequence.push(events)
                        events=[]
                       }
                     }
                        // Append to existing events or create new roadmap
                        
                        // Assuming per_sequence is an array of arrays
                        for (let i = 0; i < per_sequence.length; i++) {

                           // Create a new div for each roadmap instance
                           const roadmapDiv = $('<div>').attr('id', 'my-roadmap-' + i ).css('height', '50px').appendTo('#my-roadmap');
                              
                           roadmapDiv.css('padding-bottom', '550px');
                           // Create a new instance of the roadmap for each data point
                           roadmapDiv.roadmap(per_sequence[i], {

                              eventsPerSlide: per_sequence[i].length,

                              slide: 1,

                              onBuild: function () {
                                
                              }
                           });
                        }
                        
                        } catch (error) {
                        console.error('Error:', error);
                        }
                        }
                     </script>
                  </div>
               </div>
            </div>
            <div class="card">
               <button class="btn btn-outline-primary m-1 rounded-pill" onclick="loadPatientData()">
                  <a href="#" id="patient-table-button" onclick="loadPatientData()"> Patient Table</a>
               </button>
            </div>
         </div>
      </div>
      </div>
      </div>    
<script type="module"  type="text/javascript" >
   import {update_column} from "../static/assets/js/data.js";
  
   const Button = document.getElementById('-button');
   Button.addEventListener('click', function () {
      const patientId = document.getElementById('patient-id').value;
      update_column(patientId);
  });

   
</script>

      <script>
        function loadPatientData() {
            patientId123 = document.getElementById('patient-id').value;
            const patientTableButton = document.getElementById("patient-table-button");

            console.log(patientTableButton.textContent)
                            patientTableButton.addEventListener('click', () => {
                            if (patientId123) {
                            window.location.href = `./datatable.html?patientId=${patientId123}`;
                            } else {
                              window.location.href = `./datatable.html`;
                            }
                        })}

        
      </script>
   </body>
   
 
</html>